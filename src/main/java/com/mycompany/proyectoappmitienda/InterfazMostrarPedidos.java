/*
 * Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
 * Click nbfs://nbhost/SystemFileSystem/Templates/GUIForms/JFrame.java to edit this template
 */
package com.mycompany.proyectoappmitienda;

import java.sql.Connection;
import java.text.SimpleDateFormat;
import java.util.Date;
import java.util.Iterator;
import java.util.List;
import javax.swing.JOptionPane;
import javax.swing.table.DefaultTableModel;

/**
 *
 * @author Felipe
 */
public class InterfazMostrarPedidos extends javax.swing.JFrame {

    Conexion con;
    Connection condb;
    CRUDSqlServer crud;
    List<Pedido> listaPedidos;
    DefaultTableModel modelo;
        
    /**
     * Creates new form InterfazRegistrarProducto
     */
    public InterfazMostrarPedidos() {
        initComponents();
        jDateInicial.setDateFormatString("dd-MM-yyyy");
        jDateFinal.setDateFormatString("dd-MM-yyyy");
        modelo = (DefaultTableModel) jTPedidos.getModel();
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jPanelMosProducto = new javax.swing.JPanel();
        jLblMosPedidos = new javax.swing.JLabel();
        jLblFechaInicial = new javax.swing.JLabel();
        jLblFechaFinal = new javax.swing.JLabel();
        jDateInicial = new com.toedter.calendar.JDateChooser();
        jDateFinal = new com.toedter.calendar.JDateChooser();
        jBtnConsultar = new javax.swing.JButton();
        jBtnDetallePedido = new javax.swing.JButton();
        jBtnNuevaConsulta = new javax.swing.JButton();
        jPanelVerProductos = new javax.swing.JPanel();
        jLblMostrarPedidos = new javax.swing.JLabel();
        jScrollPane1 = new javax.swing.JScrollPane();
        jTPedidos = new javax.swing.JTable();
        jLabel1 = new javax.swing.JLabel();

        setDefaultCloseOperation(javax.swing.WindowConstants.DISPOSE_ON_CLOSE);
        setMinimumSize(new java.awt.Dimension(800, 600));
        setName("JFrameRegProd"); // NOI18N
        setSize(new java.awt.Dimension(800, 600));

        jPanelMosProducto.setBackground(new java.awt.Color(255, 255, 255));
        jPanelMosProducto.setBorder(new javax.swing.border.LineBorder(new java.awt.Color(125, 93, 251), 1, true));
        jPanelMosProducto.setForeground(new java.awt.Color(51, 51, 51));
        jPanelMosProducto.setFont(new java.awt.Font("Trebuchet MS", 0, 18)); // NOI18N

        jLblMosPedidos.setFont(new java.awt.Font("Trebuchet MS", 1, 24)); // NOI18N
        jLblMosPedidos.setForeground(new java.awt.Color(125, 93, 251));
        jLblMosPedidos.setIcon(new javax.swing.ImageIcon(getClass().getResource("/img/pedidos.png"))); // NOI18N
        jLblMosPedidos.setText("Mostrar Pedidos");

        jLblFechaInicial.setFont(new java.awt.Font("Trebuchet MS", 0, 16)); // NOI18N
        jLblFechaInicial.setText("Fecha inicial:");

        jLblFechaFinal.setFont(new java.awt.Font("Trebuchet MS", 0, 16)); // NOI18N
        jLblFechaFinal.setText("Fecha final:");

        jDateInicial.setForeground(new java.awt.Color(125, 95, 219));
        jDateInicial.setDateFormatString("yyyy-MM-dd hh.mm");
        jDateInicial.setFont(new java.awt.Font("Trebuchet MS", 1, 14)); // NOI18N

        jDateFinal.setForeground(new java.awt.Color(125, 95, 219));
        jDateFinal.setDateFormatString("yyyy-MM-dd hh.mm");
        jDateFinal.setFont(new java.awt.Font("Trebuchet MS", 1, 14)); // NOI18N

        jBtnConsultar.setBackground(new java.awt.Color(125, 93, 251));
        jBtnConsultar.setFont(new java.awt.Font("Trebuchet MS", 0, 18)); // NOI18N
        jBtnConsultar.setForeground(new java.awt.Color(255, 255, 255));
        jBtnConsultar.setIcon(new javax.swing.ImageIcon(getClass().getResource("/img/loupe.png"))); // NOI18N
        jBtnConsultar.setText("Buscar");
        jBtnConsultar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jBtnConsultarActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout jPanelMosProductoLayout = new javax.swing.GroupLayout(jPanelMosProducto);
        jPanelMosProducto.setLayout(jPanelMosProductoLayout);
        jPanelMosProductoLayout.setHorizontalGroup(
            jPanelMosProductoLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanelMosProductoLayout.createSequentialGroup()
                .addGap(51, 51, 51)
                .addGroup(jPanelMosProductoLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jLblMosPedidos, javax.swing.GroupLayout.PREFERRED_SIZE, 238, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addGroup(jPanelMosProductoLayout.createSequentialGroup()
                        .addGroup(jPanelMosProductoLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(jDateInicial, javax.swing.GroupLayout.PREFERRED_SIZE, 207, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addGroup(jPanelMosProductoLayout.createSequentialGroup()
                                .addGap(12, 12, 12)
                                .addComponent(jLblFechaInicial, javax.swing.GroupLayout.PREFERRED_SIZE, 106, javax.swing.GroupLayout.PREFERRED_SIZE)))
                        .addGap(28, 28, 28)
                        .addGroup(jPanelMosProductoLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(jLblFechaFinal, javax.swing.GroupLayout.PREFERRED_SIZE, 97, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(jDateFinal, javax.swing.GroupLayout.PREFERRED_SIZE, 219, javax.swing.GroupLayout.PREFERRED_SIZE))
                        .addGap(18, 18, 18)
                        .addComponent(jBtnConsultar, javax.swing.GroupLayout.PREFERRED_SIZE, 148, javax.swing.GroupLayout.PREFERRED_SIZE)))
                .addGap(0, 0, Short.MAX_VALUE))
        );
        jPanelMosProductoLayout.setVerticalGroup(
            jPanelMosProductoLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanelMosProductoLayout.createSequentialGroup()
                .addGap(22, 22, 22)
                .addGroup(jPanelMosProductoLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                    .addComponent(jBtnConsultar, javax.swing.GroupLayout.PREFERRED_SIZE, 43, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addGroup(jPanelMosProductoLayout.createSequentialGroup()
                        .addComponent(jLblMosPedidos, javax.swing.GroupLayout.PREFERRED_SIZE, 34, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addGroup(jPanelMosProductoLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(jLblFechaInicial)
                            .addComponent(jLblFechaFinal))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addGroup(jPanelMosProductoLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(jDateInicial, javax.swing.GroupLayout.PREFERRED_SIZE, 30, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(jDateFinal, javax.swing.GroupLayout.PREFERRED_SIZE, 30, javax.swing.GroupLayout.PREFERRED_SIZE))))
                .addContainerGap(14, Short.MAX_VALUE))
        );

        jBtnDetallePedido.setBackground(new java.awt.Color(125, 93, 251));
        jBtnDetallePedido.setFont(new java.awt.Font("Trebuchet MS", 0, 18)); // NOI18N
        jBtnDetallePedido.setForeground(new java.awt.Color(255, 255, 255));
        jBtnDetallePedido.setIcon(new javax.swing.ImageIcon(getClass().getResource("/img/registered-document.png"))); // NOI18N
        jBtnDetallePedido.setText("Detalle");
        jBtnDetallePedido.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jBtnDetallePedidoActionPerformed(evt);
            }
        });

        jBtnNuevaConsulta.setBackground(new java.awt.Color(125, 93, 251));
        jBtnNuevaConsulta.setFont(new java.awt.Font("Trebuchet MS", 0, 18)); // NOI18N
        jBtnNuevaConsulta.setForeground(new java.awt.Color(255, 255, 255));
        jBtnNuevaConsulta.setIcon(new javax.swing.ImageIcon(getClass().getResource("/img/refresh.png"))); // NOI18N
        jBtnNuevaConsulta.setText("Nueva Consulta");
        jBtnNuevaConsulta.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jBtnNuevaConsultaActionPerformed(evt);
            }
        });

        jPanelVerProductos.setBackground(new java.awt.Color(255, 255, 255));
        jPanelVerProductos.setBorder(new javax.swing.border.LineBorder(new java.awt.Color(125, 93, 251), 1, true));
        jPanelVerProductos.setForeground(new java.awt.Color(51, 51, 51));
        jPanelVerProductos.setFont(new java.awt.Font("Trebuchet MS", 0, 18)); // NOI18N

        jLblMostrarPedidos.setFont(new java.awt.Font("Trebuchet MS", 1, 18)); // NOI18N
        jLblMostrarPedidos.setForeground(new java.awt.Color(125, 93, 251));
        jLblMostrarPedidos.setText("Pedidos");

        jTPedidos.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {
                {null, null, null, null, null, null, null},
                {null, null, null, null, null, null, null},
                {null, null, null, null, null, null, null},
                {null, null, null, null, null, null, null}
            },
            new String [] {
                "Numero", "Mesa", "Grupo", "Persona", "Fecha", "Estado", "Total"
            }
        ));
        jScrollPane1.setViewportView(jTPedidos);

        javax.swing.GroupLayout jPanelVerProductosLayout = new javax.swing.GroupLayout(jPanelVerProductos);
        jPanelVerProductos.setLayout(jPanelVerProductosLayout);
        jPanelVerProductosLayout.setHorizontalGroup(
            jPanelVerProductosLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanelVerProductosLayout.createSequentialGroup()
                .addGroup(jPanelVerProductosLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(jPanelVerProductosLayout.createSequentialGroup()
                        .addGap(66, 66, 66)
                        .addComponent(jLblMostrarPedidos, javax.swing.GroupLayout.PREFERRED_SIZE, 238, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addGroup(jPanelVerProductosLayout.createSequentialGroup()
                        .addGap(33, 33, 33)
                        .addComponent(jScrollPane1, javax.swing.GroupLayout.PREFERRED_SIZE, 624, javax.swing.GroupLayout.PREFERRED_SIZE)))
                .addContainerGap(33, Short.MAX_VALUE))
        );
        jPanelVerProductosLayout.setVerticalGroup(
            jPanelVerProductosLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanelVerProductosLayout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jLblMostrarPedidos, javax.swing.GroupLayout.PREFERRED_SIZE, 34, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jScrollPane1, javax.swing.GroupLayout.PREFERRED_SIZE, 189, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap(28, Short.MAX_VALUE))
        );

        jLabel1.setIcon(new javax.swing.ImageIcon(getClass().getResource("/img/logo.PNG"))); // NOI18N

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addGap(216, 216, 216)
                        .addComponent(jBtnDetallePedido, javax.swing.GroupLayout.PREFERRED_SIZE, 164, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addGap(46, 46, 46)
                        .addComponent(jBtnNuevaConsulta, javax.swing.GroupLayout.PREFERRED_SIZE, 200, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addGroup(layout.createSequentialGroup()
                        .addGap(54, 54, 54)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                            .addComponent(jPanelVerProductos, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                            .addComponent(jPanelMosProducto, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)))
                    .addGroup(layout.createSequentialGroup()
                        .addGap(177, 177, 177)
                        .addComponent(jLabel1)))
                .addContainerGap(54, Short.MAX_VALUE))
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jLabel1, javax.swing.GroupLayout.PREFERRED_SIZE, 70, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(18, 18, 18)
                .addComponent(jPanelMosProducto, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(18, 18, 18)
                .addComponent(jPanelVerProductos, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addGap(18, 18, 18)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jBtnDetallePedido, javax.swing.GroupLayout.PREFERRED_SIZE, 43, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jBtnNuevaConsulta, javax.swing.GroupLayout.PREFERRED_SIZE, 43, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(17, 17, 17))
        );

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void jBtnDetallePedidoActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jBtnDetallePedidoActionPerformed
        int filaPedido = jTPedidos.getSelectedRow();
        Object pedido = modelo.getValueAt(filaPedido, 0);
        Object mesa = modelo.getValueAt(filaPedido, 1);
        Object grupo = modelo.getValueAt(filaPedido, 2);
        Object persona = modelo.getValueAt(filaPedido, 3);
        Object estado = modelo.getValueAt(filaPedido, 5);
        
        int pedidoAux = Integer.parseInt(pedido.toString());
        int mesaAux = Integer.parseInt(mesa.toString());
        int grupoAux = Integer.parseInt(mesa.toString());
        
        Pedido pedidoDetalle = new Pedido();
        pedidoDetalle.setIdPedido(pedidoAux);
        pedidoDetalle.setNombre(persona.toString());
        pedidoDetalle.setNumeroMesa(mesaAux);
        pedidoDetalle.setIdGrupo(grupoAux);
        if(estado.toString().matches("Pagado")){
            pedidoDetalle.setEstado(1);
        }else{
            pedidoDetalle.setEstado(0);
        }
        
              
        new InterfazMostrarPedido(pedidoDetalle).setVisible(true);
        dispose();

    }//GEN-LAST:event_jBtnDetallePedidoActionPerformed

    public void imprimirPedidos() {
        //defino el modelo de la tabla y le indico como se llama
        DefaultTableModel modelo;
        modelo = (DefaultTableModel) jTPedidos.getModel();

        //Limpiar la tabla
        int i = 0;
        if (modelo.getRowCount() != 0) {
            while (i != -1) {
                try {
                    modelo.removeRow(modelo.getRowCount() - 1);
                } catch (Exception e) {
                    i = -1;
                }
            }
        }
        try {

            List<Pedido> listaP = listaPedidos;
            Iterator<Pedido> it = listaP.iterator();
            //como uso 5 columnas el arreglo es de 5
            String[] obj = new String[7];
            while (it.hasNext()) {
                Pedido p = it.next();
                obj[0] = String.valueOf(p.getIdPedido());
                obj[1] = String.valueOf(p.getNumeroMesa());
                obj[2] = String.valueOf(p.getIdGrupo());
                obj[3] = p.getNombre();
                obj[4] = String.valueOf(p.getFechaPedido());
                if (p.getEstado() == 1) {
                    obj[5] = "Pagado";
                } else {
                    obj[5] = "Debe";
                }
                obj[6] = String.valueOf(p.getTotal());

                modelo.addRow(obj);

            }
        } catch (Exception e) {
            System.out.println("Error: " + e);
        }

    }

    private void jBtnNuevaConsultaActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jBtnNuevaConsultaActionPerformed

        limpiarTabla();

        jDateInicial.setDate(null);
        jDateFinal.setDate(null);
    }//GEN-LAST:event_jBtnNuevaConsultaActionPerformed

    private void jBtnConsultarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jBtnConsultarActionPerformed
        try {
            
            con = new Conexion();
            condb = con.ObtenerConexion();
            crud = new CRUDSqlServer();
            if (jDateInicial.getDate() != null && jDateFinal.getDate() != null) {
                // Obtén la fecha del JDateChooser
                Date fecha1 = jDateInicial.getDate();
                Date fecha2 = jDateFinal.getDate();

                // Crea un formato de fecha con año, mes, día, horas y minutos
                SimpleDateFormat sdf = new SimpleDateFormat("yyyy-MM-dd HH:mm");

                // Convierte la fecha a un String
                String fechaString1 = sdf.format(fecha1);
                String fechaString2 = sdf.format(fecha2);

                listaPedidos = crud.obtenerPedidos(condb, fechaString1, fechaString2);
                imprimirPedidos();
            }

        } catch (Exception e) {
            JOptionPane.showMessageDialog(rootPane, "Datos errores.  Revise de nuevo");
            e.printStackTrace();
        }
    }//GEN-LAST:event_jBtnConsultarActionPerformed

    public void limpiarTabla() {
        DefaultTableModel dm = (DefaultTableModel) jTPedidos.getModel();
        while (dm.getRowCount() > 0) {
            dm.removeRow(0);
        }
    }

    


    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton jBtnConsultar;
    private javax.swing.JButton jBtnDetallePedido;
    private javax.swing.JButton jBtnNuevaConsulta;
    private com.toedter.calendar.JDateChooser jDateFinal;
    private com.toedter.calendar.JDateChooser jDateInicial;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLblFechaFinal;
    private javax.swing.JLabel jLblFechaInicial;
    private javax.swing.JLabel jLblMosPedidos;
    private javax.swing.JLabel jLblMostrarPedidos;
    private javax.swing.JPanel jPanelMosProducto;
    private javax.swing.JPanel jPanelVerProductos;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JTable jTPedidos;
    // End of variables declaration//GEN-END:variables
}
